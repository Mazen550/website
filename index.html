<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Valentine's Day</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>

    <script defer>
        // CANVAS SETUP
        const canvas = document.getElementById("starfield");
        const context = canvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        // STARFIELD
        const stars = 800;
        const colorrange = [0, 60, 240];
        const starArray = [];

        function getRandom(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        for (let i = 0; i < stars; i++) {
            starArray.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.5,
                hue: colorrange[getRandom(0, colorrange.length - 1)],
                sat: getRandom(50, 100),
                opacity: Math.random()
            });
        }

        // TEXT TIMING
        let frameNumber = 0;
        let opacity = 0;
        let secondOpacity = 0;
        let thirdOpacity = 0;

        // HEART
        let heartParticles = [];
        const heartCount = 3000;
        let heartAngle = 0;
        let heartVisible = false;

        function heartShape(t, layer) {
            const scale = 12;
            return {
                x: scale * 16 * Math.pow(Math.sin(t), 3),
                y: -scale * (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)),
                z: layer
            };
        }

        function createHeart() {
            heartParticles = [];
            const layers = 30;
            const particlesPerLayer = Math.floor(heartCount / layers);

            for (let layer = 0; layer < layers; layer++) {
                let zDepth = (layer / layers - 0.5) * 150;
                for (let i = 0; i < particlesPerLayer; i++) {
                    let t = (i / particlesPerLayer) * Math.PI * 2;
                    let pos = heartShape(t, zDepth);
                    let randomScale = Math.random();
                    heartParticles.push({
                        currentX: (Math.random() - 0.5) * canvas.width * 2,
                        currentY: (Math.random() - 0.5) * canvas.height * 2,
                        currentZ: (Math.random() - 0.5) * 1000,
                        targetX: pos.x * randomScale,
                        targetY: pos.y * randomScale,
                        targetZ: pos.z + (Math.random() - 0.5) * 20
                    });
                }
            }
        }
        createHeart();

        // DRAW FUNCTIONS
        function drawStars() {
            for (let star of starArray) {
                context.beginPath();
                context.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                context.fillStyle = `hsla(${star.hue},${star.sat}%,88%,${star.opacity})`;
                context.fill();
                if (Math.random() > 0.99) star.opacity = Math.random();
            }
        }

        function drawHeart() {
            heartAngle += 0.008;
            const cos = Math.cos(heartAngle);
            const sin = Math.sin(heartAngle);

            const sortedParticles = heartParticles.slice().sort((a,b)=>{
                const za = a.targetX * sin + a.targetZ * cos;
                const zb = b.targetX * sin + b.targetZ * cos;
                return za - zb;
            });

            for (let p of sortedParticles) {
                // convergence
                p.currentX += (p.targetX - p.currentX) * 0.03;
                p.currentY += (p.targetY - p.currentY) * 0.03;
                p.currentZ += (p.targetZ - p.currentZ) * 0.03;

                // rotation
                let x = p.currentX * cos - p.currentZ * sin;
                let z = p.currentX * sin + p.currentZ * cos;
                let scale = 250 / (250 + z);
                let px = x * scale + canvas.width/2;
                let py = p.currentY * scale + canvas.height/2;
                let size = scale * 2.5;
                let brightness = Math.max(0.3, Math.min(1, scale));
                context.fillStyle = `rgba(255,150,200,${brightness*0.8})`;
                context.fillRect(px, py, size, size);
            }
        }

        function drawTextWithLineBreaks(lines, x, y, fontSize, lineHeight) {
            lines.forEach((line, index) => {
                context.fillText(line, x, y + index * (fontSize + lineHeight));
            });
        }

        function drawText() {
            const fontSize = Math.min(30, canvas.width / 24);
            const lineHeight = 8;

            context.font = `${fontSize}px Comic Sans MS`;
            context.textAlign = "center";
            context.shadowColor = "rgba(255,100,200,1)";
            context.shadowBlur = 10;

            // Here we animate each text as in original code
            if(frameNumber < 300){ context.fillText("everyday day I cannot believe how lucky I am", canvas.width/2, canvas.height/2); opacity+=0.0067;}
            if(frameNumber>=300 && frameNumber<600){ context.fillText("everyday day I cannot believe how lucky I am", canvas.width/2, canvas.height/2);}
            if(frameNumber>=600 && frameNumber<900){ context.fillText("everyday day I cannot believe how lucky I am", canvas.width/2, canvas.height/2); opacity-=0.0067;}
            if(frameNumber==900) opacity=0;

            if(frameNumber>900 && frameNumber<1200){
                if(canvas.width<600){
                    drawTextWithLineBreaks(["amongst trillions and trillions of stars,","over billions of years"],canvas.width/2, canvas.height/2,fontSize,lineHeight);
                }else{
                    context.fillText("amongst trillions and trillions of stars, over billions of years",canvas.width/2,canvas.height/2);
                }
                opacity+=0.0067;
            }
            if(frameNumber>=1200 && frameNumber<1500){
                if(canvas.width<600){
                    drawTextWithLineBreaks(["amongst trillions and trillions of stars,","over billions of years"],canvas.width/2, canvas.height/2,fontSize,lineHeight);
                }else{
                    context.fillText("amongst trillions and trillions of stars, over billions of years",canvas.width/2,canvas.height/2);
                }
            }
            if(frameNumber>=1500 && frameNumber<1800){
                if(canvas.width<600){
                    drawTextWithLineBreaks(["amongst trillions and trillions of stars,","over billions of years"],canvas.width/2, canvas.height/2,fontSize,lineHeight);
                }else{
                    context.fillText("amongst trillions and trillions of stars, over billions of years",canvas.width/2,canvas.height/2);
                }
                opacity-=0.0067;
            }
            if(frameNumber==1800) opacity=0;

            // Third text
            if(frameNumber>1800 && frameNumber<2100){ context.fillText("to be alive, and to get to spend this life with you",canvas.width/2,canvas.height/2); opacity+=0.0067;}
            if(frameNumber>=2100 && frameNumber<2400){ context.fillText("to be alive, and to get to spend this life with you",canvas.width/2,canvas.height/2);}
            if(frameNumber>=2400 && frameNumber<2700){ context.fillText("to be alive, and to get to spend this life with you",canvas.width/2,canvas.height/2); opacity-=0.0067;}
            if(frameNumber==2700) opacity=0;

            // Fourth text
            if(frameNumber>2700 && frameNumber<3000){ context.fillText("is so incredibly, unfathomably unlikely",canvas.width/2,canvas.height/2); opacity+=0.0067;}
            if(frameNumber>=3000 && frameNumber<3300){ context.fillText("is so incredibly, unfathomably unlikely",canvas.width/2,canvas.height/2);}
            if(frameNumber>=3300 && frameNumber<3600){ context.fillText("is so incredibly, unfathomably unlikely",canvas.width/2,canvas.height/2); opacity-=0.0067;}
            if(frameNumber==3600) opacity=0;

            // Fifth text
            if(frameNumber>3600 && frameNumber<3900){ context.fillText("and yet here I am to get the impossible chance to get to know you",canvas.width/2,canvas.height/2); opacity+=0.0067;}
            if(frameNumber>=3900 && frameNumber<4200){ context.fillText("and yet here I am to get the impossible chance to get to know you",canvas.width/2,canvas.height/2);}
            if(frameNumber>=4200 && frameNumber<4500){ context.fillText("and yet here I am to get the impossible chance to get to know you",canvas.width/2,canvas.height/2); opacity-=0.0067;}
            if(frameNumber==4500) opacity=0;

            if(frameNumber>4500){
                context.fillStyle = `rgba(255,150,200,${secondOpacity})`;
                context.fillText("I love you so much Dalal, more than all the time and space in the universe can contain",canvas.width/2,canvas.height*0.18);
                if(secondOpacity<1) secondOpacity+=0.0067;
            }

            if(frameNumber>4800){
                context.fillStyle = `rgba(255,150,200,${thirdOpacity})`;
                context.fillText("and I can't wait to spend all the time in the world to share that love with you!",canvas.width/2,canvas.height*0.18+60);
                if(thirdOpacity<1) thirdOpacity+=0.0067;
            }

            if(frameNumber>4980) heartVisible=true;

            context.shadowBlur=0;
        }

        // MAIN LOOP
        function draw() {
            context.fillStyle = "rgba(0,0,0,0.25)";
            context.fillRect(0,0,canvas.width,canvas.height);

            drawStars();
            drawText();
            if(heartVisible) drawHeart();

            frameNumber++;
            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
